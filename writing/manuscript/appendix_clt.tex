This appendix describes in detail how taking an infinitesimal limit where the
number of loci becomes large as the effect size per mutation becomes small,
yields a multivariate normal distribution of individual trait values. The
resulting normal model leads to equation \eqref{eq:normcov}, which gives the
covariance in individual trait differences. Equation \eqref{eq:normcov} is later
used to simulate from the null distribution of $Q_{ST}$ in the main text section
on trait divergence in structured populations. The first section of this
appendix describes a full central limit theorem argument for obtaining the
means, variances, and covariances that are given in the main text section on the
infinitesimal limit. The second section provides a heuristic derivation of the
same means, variances and covariances. The third section explains how these
results for the joint trait distribution in the infinitesimal limit relate to
trait distributions in panmictic populations where individuals are exchangeable.

\subsection*{A central limit theorem derivation}
The moment generating function for the distribution of trait values from a
single locus is
\begin{equation*}
  \varphi_{\mathbf{Y}}(\mathbf{k}) = \int \exp \left( \sum_{\omega \in \Omega} s_{\omega}t_{\omega} \right)
  \Pro(\mathbf{T}=\mathbf{t})\mathrm{d}\mathbf{t}
  \Bigr|_{s_{\omega}=\frac{\theta}{2} \left( \psi\left(\sum_{a \in \omega}k_{a}\right) -1 \right)}.
\end{equation*}
If we substitute in the Taylor series expansions for the moment generating
function of the trait value distribution we get
\begin{equation*}
  \int \prod_{\Omega} \exp\left[ t_{\omega} \T \left( \sum_{n=1}^{\infty} \frac{m_n}{n!}
    \left( \sum_{a \in \omega} k_a \right)^n \right) \right]
  \Pro(\mathbf{T} = \mathbf{t}) \mathrm{d}\mathbf{t}.
\end{equation*}
If we then write the Taylor series of each exponential function we get
\begin{equation*}
  \int \prod_{\Omega} \left[ \sum_{j=0}^\infty \frac{t_{\omega}^j}{j!}
  \left( \T \right)^j \left( \sum_{n=1}^{\infty} \frac{m_n}{n!}
  \left( \sum_{a \in \omega} k_a \right)^n \right)^j \right]
  \Pro(\mathbf{T} = \mathbf{t}) \mathrm{d}\mathbf{t},
\end{equation*}
which is equivalent to
\begin{equation*}
  1 + \sum_{\Omega} \E[T_\omega] \T \sum_{n=1}^{\infty} \frac{m_n}{n!} \left(
  \sum_{a \in \omega} k_a \right)^n +
  \sum_{\Omega \times \Omega} \frac{1}{2} E[T_{\omega_1}T_{\omega_2}]
  \sum_{n=1}^{\infty} \T \frac{m_n}{n!} \left(\sum_{a \in \omega_1} k_a \right)^n
  \sum_{n=1}^{\infty} \T \frac{m_n}{n!} \left(\sum_{a \in \omega_2} k_a \right)^n + \ldots
\end{equation*}

This is raised to the power $L$ for a trait controlled by $L$ loci. We want the
limit as the number of loci increases while the size of mutational effects
decreases. This can be expressed by the limits $L m_1 \to \mu_1$, $L m_2\to
\mu_2$ and $L m_i\to 0$ for $i>2$ as $L \to \infty$. Knowing we will not be
retaining $m_3$ and above we can rewrite the mgf as
\begin{equation*}
  \left(1 + \sum_{\Omega} \E[T_\omega] \T \left(m_1 \sum_{a \in \omega} k_a +
  \frac{m_2}{2} \left(\sum_{a \in \omega} k_a \right)^2\right)\right)^L.
\end{equation*}
The result of taking these limits is
\begin{equation}
  \label{eq:norm_mgf}
  \exp \left( \sum_{\omega \in \Omega}\E[T_{\omega}] \T \left( \mu_1 
  \sum_{a \in \omega} k_a + \frac{\mu_2}{2}\left( \sum_{a \in \omega}
  k_a\right)^2\right)\right).
\end{equation}

This is multivariate normal distribution with mean equal to $\E[T_{MRCA}] \T \mu_1$,
variance equal to $\E[T_{MRCA}] \T \mu_2$, and covariance between $Y_a$ and $Y_b$
equal to $\E[\tau_{a+b}] \T \mu_2$. This can be seen from equation
\eqref{eq:norm_mgf} by noting that in the mgf for a multivariate normal
distribution the coefficient in the exponential of $k_a$ is the mean of $Y_a$
and the coefficient of $k_ak_b$ is $2\Cov[Y_a,Y_b]$ if $a\neq b$ and $\Var[Y_a]$
if $a=b$.

These $Y$ values are not directly observed because in the theory presented here
they are measured as the sum of differences since the $T_{MRCA}$s at the causal
loci affecting the trait. Rather, differences between individual trait values
are what analyses would be based on. Since the $Y$ are normally distributed
differences between trait values such as $Y_a-Y_b$ will be as well.
\begin{align*}
  \Var[Y_a-Y_b] &= Var[Y_a] + \Var[Y_b] - 2\Cov[Y_a,Y_b]\\
                &= 2(\E[T_{MRCA}] - \E[\tau_{a+b}])\mu_2.
\end{align*}
The same argument is used to arrive at equation \eqref{eq:normcov} in the main
text. The covariance between all pairs of differences in trait values determines
any observable statistics in the infinitesimal limit. 

\subsection{A heuristic derivation}

A much simpler heuristic derivation of the limiting normal distribution can be
done by calculating the variance and covariance at a single locus. This
derivation is very similar to that done by \citet{Schraiber2015}. Using the law
of total variance we can write
\begin{equation*}
  \Var[Y] = \E\left[\Var[Y|T]\right] +
  \Var\left[\E[Y|T]\right]
\end{equation*}
The variance conditional on $T$ can be calculated again using the law of total
variance and conditioning on the number of mutations at the locus. 
\begin{align*}
  \Var[Y|T] &= \E[\Var[Y|M]|T] + \Var[E[Y|M]|T]\\
            &= \E[M(m_2-m_1^2)|T] + \Var[Mm_1|T]\\
            &= \T T (m_2-m_1^2) + \T T m_1^2\\
            &= \T T m_2
\end{align*}
\begin{align*}
  \E[Y|T] = \T T m_1\\
  \Var[\T T m_1] = \left( \T m_1\right)^2\Var[T]
\end{align*}
Therefore we have
\begin{equation}
  \Var[T] = \T m_2 \E[T_{MRCA}] + (\T m_1)^2 \Var[T_{MRCA}].
\end{equation}

The same procedure can be done for the covariance.
\begin{equation*}
  \Cov[Y_a,Y_b] = \E[\Cov[Y_a,Y_b|T]] + \Cov[E[Y_a|T],E[Y_b|T]]
\end{equation*}
We can break $Y_a$ and $Y_b$ into a shared part, $Y_S$ and unshared parts for
each, $Y_{\delta a}$ and $Y_{\delta b}$.
\begin{align*}
  \Cov[Y_S + Y_{\delta a}, Y_S + Y_{\delta b}|T] = \Var[Y_s|T] = \T \tau_{a+b} m_2.\\
  E[\T \tau_{a+b} m_2] = \T m_2\E[\tau_{a+b}]
\end{align*}
\begin{align*}
  \Cov[E[Y_a|T],E[Y_b|T]] = \Cov[\T T m_1, \T T m_1] = \left( \T m_1 \right)^2\Var[T_{MRCA}]
\end{align*}
Therefore we have
\begin{equation}
  \Cov[Y_a,Y_b] = \T m_2 \E[\tau_{a+b}] + \left( \T m_1 \right)^2 \Var[T_{MRCA}].
\end{equation}
The terms proportional to the variance of the $T_{MRCA}$ disappear because
$Lm_1^2 \to 0$ as $L \to \infty$.

\subsection*{Within-population trait distributions}

The above theory considers the distribution of trait values over realizations of
the neutral evolutionary process and shows that this is multivariate normal. As
discussed in the main text section on the infinitesimal limit, we also
intuitively expect that the distribution of trait values within a randomly
mating population will be univariate normal. These two perspectives are easily
reconciled using multivariate normal theory. In a population of size $N$, the
trait values $\mathbf{Y}=(Y_1,\ldots,Y_N)$ are exchangeable normal random
variables. They are therefore jointly multivariate normal with a common mean
$\mathcal{M}$, common variance $\mathcal{V}$, and common covariance
$\mathcal{D}$ \citep{Tong}. If the mean value in the population is
$\bar{Y}=\frac{1}{N}\sum_{i=1}^N Y_i$, then
\begin{equation}
  \E[Y_i-\bar{Y}] = 0,
\end{equation}
\begin{equation}
  \label{eq:exvar}
  \Var[Y_i-\bar{Y}] = \mathcal{V} - 2 \frac{(N-1)\mathcal{D} + \mathcal{V}}{N} +
  \frac{N(N-1)\mathcal{D} + N\mathcal{V}}{N^2} \approx \mathcal{V} - \mathcal{D},
\end{equation}
and
\begin{equation}
  \Cov[Y_i-\bar{Y},Y_j-\bar{Y}] = \mathcal{D} - 2 \frac{(N-1)\mathcal{D} + \mathcal{V}}{N} +
  \frac{N(N-1)\mathcal{D} + N\mathcal{V}}{N^2} \approx 0.
\end{equation}
The within-population trait value are therefore approximately i.i.d. normal
around the population mean. In the infinitesimal limit we have $\mathcal{V} =
\E[T_{MRCA}] \T \mu_2$ and $\mathcal{D} = \E[\tau_{a+b}] \T \mu_2$. The
within-population variance is therefore $\E[T_{MRCA}] \T \mu_2 - \E[\tau_{a+b}]
\T \mu_2 = \E[\mathbbm{T}_{2,2}]\T\mu_2$.

The reasoning here applies to any situation where the marginal trait values are
normal and individuals are exchangeable. As mentioned in the discussion, a
situation of particular interest is the case of dominance. In a diploid model
with dominance we would also get a marginal normal distribution when summing
over independent loci. Equation \eqref{eq:exvar} would therefore still apply and
we would get a within-population variance analogous to
$\E[\mathbbm{T}_{2,2}]\T\mu_2$ that depends on moments of the genealogical,
mutational, and dominance distributions.

%%% Local Variables:
%%% TeX-master: "quant_gen_manu.tex"
%%% End:
